
<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profil Bo'limi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      @keyframes slideIn {
        0% {
          transform: translateY(-20px);
          opacity: 0;
        }
        100% {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @keyframes fadeIn {
        0% {
          opacity: 0;
          transform: scale(0.95);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes fadeOut {
        0% {
          opacity: 1;
          transform: scale(1);
        }
        100% {
          opacity: 0;
          transform: scale(0.95);
        }
      }

      @keyframes slideUp {
        0% {
          transform: translateY(100%);
          opacity: 0;
        }
        100% {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .notification {
        animation: slideIn 0.3s ease-out forwards;
      }

      .address-item,
      .card-item,
      .installment-item {
        animation: fadeIn 0.4s ease-out forwards;
      }

      .panel {
        transition: all 0.3s ease;
        opacity: 0;
        transform: translateY(10px);
        height: 0;
        overflow: hidden;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
      }

      .panel.active {
        opacity: 1;
        transform: translateY(0);
        height: auto;
        overflow: visible;
        position: relative;
      }

      .tab-button {
        transition: all 0.2s ease;
      }

      .tab-button.active {
        background-color: #4f46e5;
        color: white;
      }

      .card-logo {
        height: 24px;
        width: auto;
        object-fit: contain;
      }

      .form-container {
        transition: all 0.3s ease;
        max-height: 1000px;
        overflow: hidden;
      }

      .form-container.hidden {
        max-height: 0;
        opacity: 0;
        padding-top: 0;
        padding-bottom: 0;
        margin-bottom: 0;
      }

      .main-layout {
        display: flex;
        justify-content: center;
        margin-top: 50px;
        gap: 30px;
        align-items: flex-start;
        padding-bottom: 50px;
      }

      .profile-sidebar {
        position: sticky;
        top: 20px;
        width: 380px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        padding: 1.5rem;
        font-family: sans-serif;
        color: #1f2937;
      }

      .content-area {
        width: 950px;
        position: relative;
        min-height: 600px;
      }

      .card-gradient-uzcard {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
      }

      .card-gradient-humo {
        background: linear-gradient(135deg, #ea580c 0%, #f97316 100%);
      }

      .card-gradient-other {
        background: linear-gradient(135deg, #6b21a8 0%, #9333ea 100%);
      }

      .status-badge {
        @apply px-3 py-1 rounded-full text-xs font-semibold;
      }

      .status-active {
        @apply bg-blue-100 text-blue-800;
      }

      .status-completed {
        @apply bg-green-100 text-green-800;
      }

      .status-overdue {
        @apply bg-red-100 text-red-800;
      }

      .btn-primary {
        @apply bg-[#4F46E5] hover:bg-[#4338CA] text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 shadow-md hover:shadow-lg;
      }

      .btn-secondary {
        @apply bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 shadow-md hover:shadow-lg;
      }

      .btn-outline {
        @apply border border-gray-300 hover:border-[#4F46E5] text-gray-700 hover:text-[#4F46E5] px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 shadow-sm hover:shadow-md;
      }

      .card-form-wrapper {
        position: relative;
        z-index: 10;
      }

      .data-table {
        @apply min-w-full divide-y divide-gray-200;
      }

      .data-table th {
        @apply px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider;
      }

      .data-table td {
        @apply px-6 py-4 whitespace-nowrap text-sm;
      }

      .details-panel {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.95);
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        background: white;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        z-index: 100;
        border-radius: 12px;
        overflow-y: auto;
        opacity: 0;
        transition: all 0.3s ease;
        pointer-events: none;
      }

      .details-panel.active {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
        pointer-events: all;
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 99;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      .overlay.active {
        opacity: 1;
        pointer-events: all;
      }

      .installment-progress {
        height: 8px;
        border-radius: 4px;
        background: #e5e7eb;
        overflow: hidden;
      }

      .installment-progress-bar {
        height: 100%;
        background: #4f46e5;
        border-radius: 4px;
      }

      .payment-method.active {
        border-color: #4f46e5;
        background-color: #eef2ff;
        box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
      }

      .panel-header {
        position: sticky;
        top: 0;
        background: white;
        z-index: 10;
        padding: 1.5rem;
        border-bottom: 1px solid #e5e7eb;
        margin: -1.5rem -1.5rem 1.5rem -1.5rem;
      }

      .card-type-logo {
        position: absolute;
        right: 1.5rem;
        top: 1.5rem;
        width: 40px;
        height: 25px;
        object-fit: contain;
      }

      .panel-content {
        padding-top: 1.5rem;
      }

      .chat-message-time {
        font-size: 0.75rem;
        color: #6b7280;
        margin-top: 0.25rem;
      }

      .chat-message-incoming {
        background-color: #f3f4f6;
        border-radius: 1rem 1rem 1rem 0;
      }

      .chat-message-outgoing {
        background-color: #4f46e5;
        color: white;
        border-radius: 1rem 1rem 0 1rem;
      }

      .sticky-panel-header {
        position: sticky;
        top: 0;
        background: white;
        z-index: 20;
        padding: 1rem;
        border-bottom: 1px solid #e5e7eb;
      }

      .edit-form {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .form-group {
        margin-bottom: 1rem;
      }

      .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #374151;
      }

      .form-input {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        transition: border-color 0.2s;
      }

      .form-input:focus {
        outline: none;
        border-color: #4f46e5;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
      }

      .save-btn {
        background-color: #4f46e5;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .s-btn {
        background-color: #4f46e5;
        color: white;
        padding-top: 7px;
        padding-bottom: 7px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      i {
        cursor: pointer;
      }
      .s-btn:hover {
        background-color: rgba(21, 0, 255, 0.604);
      }

      .save-btn:hover {
        background-color: #4338ca;
      }

      .cancel-btn {
        background-color: #f3f4f6;
        color: #374151;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: background-color 0.2s;
        margin-right: 0.5rem;
      }

      .cancel-btn:hover {
        background-color: #e5e7eb;
      }

      /* New styles for improved UI */
      .sidebar-menu-item {
        @apply flex items-center gap-3 py-2 px-3 rounded-md cursor-pointer transition-colors;
      }

      .sidebar-menu-item:hover {
        @apply bg-gray-100 text-[#4F46E5];
      }

      .sidebar-menu-item:hover i {
        @apply text-[#4F46E5];
      }

      .sidebar-menu-item i {
        @apply text-lg text-gray-500 transition-colors;
      }

      .card-toggle {
        @apply absolute right-4 top-4 text-gray-400 hover:text-gray-600 cursor-pointer;
      }

      .card-number {
        @apply font-mono tracking-wider transition-all duration-200;
      }

      .card-number.masked {
        filter: blur(4px);
      }

      .card-number.visible {
        filter: none;
      }

      .coupon-item {
        @apply border rounded-xl p-5 transition-all duration-200;
      }

      .coupon-item:hover {
        @apply shadow-md transform -translate-y-1;
      }

      .coupon-active {
        @apply bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200;
      }

      .coupon-inactive {
        @apply bg-gradient-to-r from-gray-50 to-gray-100 border-gray-200 opacity-70;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <div class="main-layout">
      <div class="profile-sidebar">
        <div class="flex items-center gap-4 border-b pb-5">
          <div
            class="w-14 h-14 bg-gray-200 rounded-full flex items-center justify-center text-2xl text-gray-500"
          >
            <i class="fas fa-user"></i>
          </div>
          <div>
            <p class="text-lg font-semibold">{{user.username}}</p>
            <p class="text-sm text-gray-500">ID: A834757</p>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3 mt-5">
          <div class="bg-gray-100 rounded-lg py-3 text-center">
            <p class="text-sm text-gray-500">Balans</p>
            <p class="font-semibold text-base">0 so'm</p>
          </div>
          <div class="bg-gray-100 rounded-lg py-3 text-center">
            <p class="text-sm text-gray-500">Ballar</p>
            <p class="font-semibold text-base">0 ball</p>
          </div>
        </div>

        <div class="flex gap-3 mt-4">
          <button
            class="btn-primary flex-1 s-btn"
            onclick="showPanel('balance')"
          >
            <i class="fas fa-wallet mr-2"></i>Hisobni to'ldirish
          </button>
          <button
            class="btn-secondary flex-1 s-btn"
            onclick="showPanel('coupons')"
          >
            <i class="fas fa-ticket-alt mr-2"></i>Kuponlar
          </button>
        </div>

        <ul class="mt-6 space-y-1">
          <li
            onclick="showPanel('info')"
            class="group flex items-center gap-3 py-2 px-3 rounded-md cursor-pointer hover:bg-gray-100 transition"
          >
            <i
              class="fas fa-user text-lg text-gray-500 group-hover:text-[#7000FF]"
            ></i>
            <span class="text-sm group-hover:text-[#7000FF]"
              >Shaxsiy ma'lumotlar</span
            >
          </li>
          <li
            onclick="showPanel('cards')"
            class="sidebar-menu-item group flex items-center gap-3 py-2 px-3 rounded-md cursor-pointer hover:bg-gray-100 transition"
          >
            <i
              class="fas fa-credit-card text-lg text-gray-500 group-hover:text-[#7000FF]"
            ></i>
            <span class="text-sm group-hover:text-[#7000FF]">Kartalar</span>
          </li>
          <li
            onclick="showPanel('transactions')"
            class="sidebar-menu-item group flex items-center gap-3 py-2 px-3 rounded-md cursor-pointer hover:bg-gray-100 transition"
          >
            <i
              class="fas fa-exchange-alt text-lg text-gray-500 group-hover:text-[#7000FF]"
            ></i>
            <span class="text-sm group-hover:text-[#7000FF]">Tranzaksiyalar</span>
          </li>
          <li
            onclick="showPanel('orders')"
            class="sidebar-menu-item group flex items-center gap-3 py-2 px-3 rounded-md cursor-pointer hover:bg-gray-100 transition"
          >
            <i
              class="fas fa-box-open text-lg text-gray-500 group-hover:text-[#7000FF]"
            ></i>
            <span class="text-sm group-hover:text-[#7000FF]">Buyurtmalarim</span>
          </li>
          <li
            onclick="showPanel('installment')"
            class="sidebar-menu-item group flex items-center gap-3 py-2 px-3 rounded-md cursor-pointer hover:bg-gray-100 transition"
          >
            <i
              class="fas fa-file-invoice text-lg text-gray-500 group-hover:text-[#7000FF]"
            ></i>
            <span class="text-sm group-hover:text-[#7000FF]">Bo'lib to'lash</span>
          </li>
          <li
            onclick="showPanel('chat')"
            class="sidebar-menu-item group flex items-center gap-3 py-2 px-3 rounded-md cursor-pointer hover:bg-gray-100 transition"
          >
            <i
              class="fas fa-comment-dots text-lg text-gray-500 group-hover:text-[#7000FF]"
            ></i>
            <span class="text-sm group-hover:text-[#7000FF]">Chat</span>
          </li>
          <li
            onclick="showPanel('address')"
            class="sidebar-menu-item group flex items-center gap-3 py-2 px-3 rounded-md cursor-pointer hover:bg-gray-100 transition"
          >
            <i
              class="fas fa-map-marker-alt text-lg text-gray-500 group-hover:text-[#7000FF]"
            ></i>
            <span class="text-sm">Manzillarim</span>
          </li>
          <a class="hover:text-[#7000FF] group-hover:text-[#7000FF]" href="{% url 'home' %}">
            <li
        
              class="sidebar-menu-item group flex items-center gap-3 py-2 px-3 rounded-md cursor-pointer hover:bg-gray-100  transition"
            >
              <i
                class="fa-solid fa-home text-lg text-gray-500 group-hover:text-[#7000FF]"
              ></i>
              <span class="text-sm hover:text-[#7000FF group-hover:text-[#7000FF]]">Bosh sahifaga qaytish</span>
            </li>
          </a>
        </ul>

        <div class="mt-6 pt-4 border-t">
          <a
            href="{% url 'logout' %}"
            class="flex items-center gap-2 text-sm text-red-500 hover:underline"
          >
            <i class="fas fa-sign-out-alt"></i> Chiqish
          </a>
        </div>
      </div>

      <div class="content-area">
        <div
          id="notificationContainer"
          class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-md"
        ></div>

        <!-- Buyurtmalar paneli -->
        <div
          id="ordersPanel"
          class="panel active w-full bg-white rounded-xl shadow-sm p-6"
        >
          <div class="sticky-panel-header">
            <h2 class="text-2xl font-bold text-gray-800">
              <i class="fas fa-box-open mr-2 text-[#4F46E5]"></i>Buyurtmalarim
            </h2>
          </div>

          <div class="panel-content w-full">
            <div class="overflow-x-auto ">
              <table class="data-table w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3">#</th>
                    <th class="px-4 py-3">Buyurtma raqami</th>
                    <th class="px-4 py-3">Sana</th>
                    <th class="px-4 py-3">Summasi</th>
                    <th class="px-4 py-3">Holati</th>
                    <th class="px-4 py-3">Harakatlar</th>
                  </tr>
                </thead>
                <tbody class="divide-y w-full divide-gray-200">
                  <tr>
                    <td class="px-4 py-3">1</td>
                    <td class="px-4 py-3 font-medium text-gray-900">458963</td>
                    <td class="px-4 py-3 text-gray-500">08/07/2025</td>
                    <td class="px-4 py-3 text-gray-900">550 000 so'm</td>
                    <td class="px-4 py-3">
                      <span class="status-badge status-active">Yuborilgan</span>
                    </td>
                    <td class="px-4 py-3">
                      <button
                        onclick="showOrderDetails('458963')"
                        class="text-[#4F46E5] hover:text-[#4338CA] mr-3"
                      >
                        <i class="fas fa-eye mr-1"></i>Ko'rish
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="mt-6 flex justify-between items-center">
              <div class="text-sm text-gray-500">
                Jami: <span class="font-medium">1</span> buyurtma
              </div>
              <a href="{% url 'home' %}">
                <button class="btn-primary save-btn">
                  <i class="fas fa-plus mr-2"></i> Yangi buyurtma
                </button>
              </a>
            </div>
          </div>
        </div>

        <!-- Buyurtma tafsilotlari paneli -->
        <div id="orderDetailsPanel" class="details-panel">
          <div class="p-6">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-bold">Buyurtma #458963</h3>
              <button
                onclick="hideOrderDetails()"
                class="text-gray-500 hover:text-gray-700"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>

            <div class="mb-6">
              <h4 class="font-medium text-gray-800 mb-2">Umumiy ma'lumot</h4>
              <div class="bg-gray-50 p-4 rounded-lg">
                <div class="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <p class="text-gray-500">Buyurtma raqami:</p>
                    <p class="font-medium">458963</p>
                  </div>
                  <div>
                    <p class="text-gray-500">Sana:</p>
                    <p class="font-medium">08/07/2025 14:23</p>
                  </div>
                  <div>
                    <p class="text-gray-500">Holati:</p>
                    <p>
                      <span class="status-badge status-active">Yuborilgan</span>
                    </p>
                  </div>
                  <div>
                    <p class="text-gray-500">To'lov usuli:</p>
                    <p class="font-medium">Karta orqali</p>
                  </div>
                  <div>
                    <p class="text-gray-500">Jami summa:</p>
                    <p class="font-medium">550 000 so'm</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="mb-6">
              <h4 class="font-medium text-gray-800 mb-2">Buyurtma tarkibi</h4>
              <div class="border border-gray-200 rounded-lg overflow-hidden">
                <div class="flex items-center p-4 border-b border-gray-200">
                  <div
                    class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center"
                  >
                    <i class="fas fa-box text-gray-400"></i>
                  </div>
                  <div class="ml-4 flex-1">
                    <p class="font-medium">Smartfon Xiaomi Redmi Note 12 Pro</p>
                    <p class="text-sm text-gray-500">1 x 5 500 000 so'm</p>
                  </div>
                  <div class="text-right">
                    <p class="font-medium">5 500 000 so'm</p>
                  </div>
                </div>
                <div class="p-4 bg-gray-50">
                  <div class="flex justify-between py-1">
                    <span class="text-gray-600">Mahsulotlar summasi:</span>
                    <span class="font-medium">5 500 000 so'm</span>
                  </div>
                  <div class="flex justify-between py-1">
                    <span class="text-gray-600">Yetkazib berish:</span>
                    <span class="font-medium">0 so'm</span>
                  </div>
                  <div
                    class="flex justify-between py-1 border-t border-gray-200 mt-2 pt-2"
                  >
                    <span class="text-gray-800 font-semibold">Jami:</span>
                    <span class="text-[#4F46E5] font-bold">5 500 000 so'm</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="mb-6">
              <h4 class="font-medium text-gray-800 mb-2">Yetkazib berish</h4>
              <div class="bg-gray-50 p-4 rounded-lg">
                <p class="font-medium">{{user.username}}</p>
                <p class="text-gray-600">+998 93 332 03 35</p>
                <p class="text-gray-600 mt-2">
                  Andijon shahar, Istiqlol ko'chasi 45-uy
                </p>
              </div>
            </div>

            <button class="btn-primary w-full">
              <i class="fas fa-print mr-2"></i>Chekni yuklab olish
            </button>
          </div>
        </div>

        <div id="orderOverlay" class="overlay"></div>

        <!-- Shaxsiy ma'lumotlar paneli -->
        <div
          id="infoPanel"
          class="panel w-full bg-white rounded-xl shadow-sm p-6"
        >
          <div class="sticky-panel-header flex justify-between items-center">
            <h2 class="text-2xl font-bold text-gray-800">
              <i class="fas fa-user mr-2 text-[#4F46E5]"></i>Shaxsiy ma'lumotlar
            </h2>
            <button onclick="showEditForm()" class="btn-primary">
              <i class="fas fa-edit mr-2"></i>Tahrirlash
            </button>
          </div>

          <div class="panel-content">
            <div class="flex gap-6">
              <div
                class="w-[100px] h-[100px] rounded-full bg-gray-200 flex items-center justify-center text-5xl text-gray-400"
              >
                <i class="fas fa-user"></i>
              </div>

              <div
                class="grid grid-cols-2 gap-y-4 gap-x-12 text-sm text-gray-700 w-full"
              >
                <div>
                  <span class="font-medium text-gray-600">F.I.Sh.:</span>
                  <span class="font-semibold text-black" id="display-name"
                    >{{user.username}}</span
                  >
                </div>
                <div>
                  <span class="font-medium text-gray-600">Pasport seriya:</span>
                  <span class="font-semibold text-black" id="display-passport"
                    >AB965695</span
                  >
                </div>

                <div>
                  <span class="font-medium text-gray-600"
                    >Elektron pochta:</span
                  >
                  <span class="font-semibold text-black" id="display-email"
                    >{{user.email}}</span
                  >
                </div>
                <div>
                  <span class="font-medium text-gray-600">Telefon:</span>
                  <span class="font-semibold text-black" id="display-phone"
                    >+998 93 332 03 35</span
                  >
                </div>

                <div>
                  <span class="font-medium text-gray-600">Ish joyi:</span>
                  <span class="font-semibold text-black" id="display-job"
                    >Yo'q</span
                  >
                </div>
                <div>
                  <span class="font-medium text-gray-600">Ish manzili:</span>
                  <span
                    class="font-semibold text-black"
                    id="display-job-address"
                    >Yo'q</span
                  >
                </div>

                <div>
                  <span class="font-medium text-gray-600">Tug'ilgan sana:</span>
                  <span class="font-semibold text-black" id="display-birthdate"
                    >09/10/2009</span
                  >
                </div>
                <div>
                  <span class="font-medium text-gray-600">Manzil:</span>
                  <span class="font-semibold text-black" id="display-address"
                    >Andijon shahar</span
                  >
                </div>

                <div>
                  <span class="font-medium text-gray-600">Jinsi:</span>
                  <span class="font-semibold text-black" id="display-gender"
                    >Erkak</span
                  >
                </div>
              </div>
            </div>

            <!-- Edit Form (Hidden by default) -->
            <div id="editForm" class="edit-form mt-6 hidden">
              <div class="grid grid-cols-2 gap-4">
                <div class="form-group">
                  <label class="form-label">F.I.Sh.</label>
                  <input
                    type="text"
                    id="edit-name"
                    class="form-input"
                    value="{{user.username}}"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Pasport seriya</label>
                  <input
                    type="text"
                    id="edit-passport"
                    class="form-input"
                    value="AB965695"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Elektron pochta</label>
                  <input
                    type="email"
                    id="edit-email"
                    class="form-input"
                    value="{{user.email}}"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Telefon</label>
                  <input
                    type="tel"
                    id="edit-phone"
                    class="form-input"
                    value="+998 93 332 03 35"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Ish joyi</label>
                  <input
                    type="text"
                    id="edit-job"
                    class="form-input"
                    value="Yo'q"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Ish manzili</label>
                  <input
                    type="text"
                    id="edit-job-address"
                    class="form-input"
                    value="Yo'q"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Tug'ilgan sana</label>
                  <input
                    type="date"
                    id="edit-birthdate"
                    class="form-input"
                    value="2009-10-09"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Manzil</label>
                  <input
                    type="text"
                    id="edit-address"
                    class="form-input"
                    value="Andijon shahar"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Jinsi</label>
                  <select id="edit-gender" class="form-input">
                    <option value="Erkak">Erkak</option>
                    <option value="Ayol">Ayol</option>
                  </select>
                </div>
              </div>
              <div class="flex justify-end mt-4">
                <button onclick="cancelEdit()" class="cancel-btn">
                  Bekor qilish
                </button>
                <button onclick="saveProfile()" class="save-btn">
                  Saqlash
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Kartalar paneli -->
        <div
          id="cardsPanel"
          class="panel w-full bg-white rounded-xl shadow-sm p-6"
        >
          <div class="sticky-panel-header flex justify-between items-center">
            <h2 class="text-2xl font-bold text-gray-800">
              <i class="fas fa-credit-card mr-2 text-[#4F46E5]"></i>Mening
              kartalarim
            </h2>
            <button onclick="showCardForm()" class="btn-primary save-btn">
              <i class="fas fa-plus mr-2 "></i>Yangi karta
            </button>
          </div>

          <div class="panel-content">
            <div
              id="cardForm"
              class="form-container hidden bg-gray-50 p-6 rounded-lg card-form-wrapper"
            >
              <h3 class="text-lg font-medium text-gray-800 mb-4">
                Karta qo'shish
              </h3>

              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Karta raqami</label
                  >
                  <input
                    type="text"
                    id="cardNumber"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4F46E5] focus:border-[#4F46E5]"
                    placeholder="8600 1234 5678 9010"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Karta egasi</label
                  >
                  <input
                    type="text"
                    id="cardHolder"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4F46E5] focus:border-[#4F46E5]"
                    placeholder="HUMOYUN M"
                  />
                </div>
              </div>

              <div class="grid grid-cols-3 gap-4 mb-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Amal qilish muddati</label
                  >
                  <input
                    type="text"
                    id="cardExpiry"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4F46E5] focus:border-[#4F46E5]"
                    placeholder="MM/YY"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >CVV</label
                  >
                  <input
                    type="text"
                    id="cardCvv"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4F46E5] focus:border-[#4F46E5]"
                    placeholder="123"
                  />
                </div>
                <div class="flex items-end">
                  <div class="flex-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Asosiy karta</label
                    >
                    <div class="flex items-center">
                      <input
                        type="checkbox"
                        id="mainCard"
                        class="h-4 w-4 text-[#4F46E5] focus:ring-[#4F46E5] border-gray-300 rounded"
                      />
                      <label
                        for="mainCard"
                        class="ml-2 block text-sm text-gray-700"
                        >Belgilash</label
                      >
                    </div>
                  </div>
                </div>
              </div>

              <div class="flex justify-end gap-3">
                <button
                  onclick="cancelCardForm()"
                  class="btn-outline cancel-btn"
                >
                  Bekor qilish
                </button>
                <button onclick="saveCard()" class="btn-primary save-btn">
                  <i class="fas fa-save mr-2"></i>Saqlash
                </button>
              </div>
            </div>

            <div
              id="cardsEmpty"
              class="flex flex-col items-center justify-center py-12"
            >
              <div
                class="w-32 h-32 bg-gray-100 rounded-full flex items-center justify-center mb-4"
              >
                <i class="fas fa-credit-card text-4xl text-gray-400"></i>
              </div>
              <p class="text-gray-500 mb-6">
                Sizda saqlangan kartalar mavjud emas
              </p>
              <button onclick="showCardForm()" class="btn-primary">
                <i class="fas fa-plus mr-2"></i>Karta qo'shish
              </button>
            </div>

            <div id="cardsList" class="grid grid-cols-1 gap-4"></div>
          </div>
        </div>

        <!-- Bo'lib to'lash paneli -->
        <div
          id="installmentPanel"
          class="panel w-full bg-white rounded-xl shadow-sm p-6"
        >
          <div class="sticky-panel-header flex justify-between items-center">
            <h2 class="text-2xl font-bold text-gray-800">
              <i class="fas fa-file-invoice mr-2 text-[#4F46E5]"></i>Bo'lib
              to'lash shartnomalari
            </h2>
            <div class="flex space-x-1 rounded-md bg-gray-100 p-1">
              <button
                onclick="changeInstallmentTab('active')"
                class="tab-button px-3 py-1 text-sm font-medium rounded-md active"
              >
                Faol shartnomalar
              </button>
              <button
                onclick="changeInstallmentTab('completed')"
                class="tab-button px-3 py-1 text-sm font-medium rounded-md"
              >
                Yakunlanganlar
              </button>
            </div>
          </div>

          <div class="panel-content">
            <div id="activeInstallments" class="installment-tab">
              <div class="overflow-x-auto">
                <table class="data-table">
                  <thead class="bg-gray-50">
                    <tr>
                      <th scope="col" class="px-6 py-3">Shartnoma raqami</th>
                      <th scope="col" class="px-6 py-3">Sana</th>
                      <th scope="col" class="px-6 py-3">Jami summa</th>
                      <th scope="col" class="px-6 py-3">Qolgan summa</th>
                      <th scope="col" class="px-6 py-3">Keyingi to'lov</th>
                      <th scope="col" class="px-6 py-3">Holati</th>
                      <th scope="col" class="px-6 py-3"></th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    <tr class="installment-item">
                      <td class="px-6 py-4 font-medium text-gray-900">
                        M-2023-0456
                      </td>
                      <td class="px-6 py-4 text-gray-500">15.06.2023</td>
                      <td class="px-6 py-4 text-gray-900">4 250 000 so'm</td>
                      <td class="px-6 py-4 text-gray-900">1 750 000 so'm</td>
                      <td class="px-6 py-4 text-gray-500">25.07.2023</td>
                      <td class="px-6 py-4">
                        <span class="status-badge status-active">Faol</span>
                      </td>
                      <td class="px-6 py-4 text-right">
                        <button
                          onclick="showInstallmentDetails('M-2023-0456')"
                          class="text-[#4F46E5] hover:text-[#4338CA] mr-3"
                        >
                          <i class="fas fa-eye mr-1"></i>Batafsil
                        </button>
                      </td>
                    </tr>
                    <tr class="installment-item">
                      <td class="px-6 py-4 font-medium text-gray-900">
                        M-2023-0789
                      </td>
                      <td class="px-6 py-4 text-gray-500">10.05.2023</td>
                      <td class="px-6 py-4 text-gray-900">3 500 000 so'm</td>
                      <td class="px-6 py-4 text-gray-900">2 100 000 so'm</td>
                      <td class="px-6 py-4 text-gray-500">10.08.2023</td>
                      <td class="px-6 py-4">
                        <span class="status-badge status-overdue">Qarz</span>
                      </td>
                      <td class="px-6 py-4 text-right">
                        <button
                          onclick="showInstallmentDetails('M-2023-0789')"
                          class="text-[#4F46E5] hover:text-[#4338CA] mr-3"
                        >
                          <i class="fas fa-eye mr-1"></i>Batafsil
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="mt-6 flex justify-between items-center">
                <div class="text-sm text-gray-500">
                  Jami: <span class="font-medium">2</span> faol shartnoma
                </div>
                <button class="btn-primary save-btn">
                  <i class="fas fa-file-contract mr-2"></i>Yangi shartnoma
                </button>
              </div>
            </div>

            <div id="completedInstallments" class="installment-tab hidden">
              <div class="text-center py-12">
                <div
                  class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100"
                >
                  <i class="fas fa-check text-green-600"></i>
                </div>
                <h3 class="mt-2 text-sm font-medium text-gray-900">
                  Yakunlangan shartnomalar yo'q
                </h3>
                <p class="mt-1 text-sm text-gray-500">
                  Sizda hozircha yakunlangan bo'lib to'lash shartnomalari mavjud
                  emas.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Bo'lib to'lash tafsilotlari paneli -->
        <div id="installmentDetailsPanel" class="details-panel">
          <div class="p-6">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-bold">
                Shartnoma #<span id="installmentNumber">M-2023-0456</span>
              </h3>
              <button
                onclick="hideInstallmentDetails()"
                class="text-gray-500 hover:text-gray-700"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>

            <div class="mb-6">
              <h4 class="font-medium text-gray-800 mb-2">Umumiy ma'lumot</h4>
              <div class="bg-gray-50 p-4 rounded-lg">
                <div class="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <p class="text-gray-500">Shartnoma raqami:</p>
                    <p class="font-medium" id="installmentContractNumber">
                      M-2023-0456
                    </p>
                  </div>
                  <div>
                    <p class="text-gray-500">Sana:</p>
                    <p class="font-medium" id="installmentDate">15.06.2023</p>
                  </div>
                  <div>
                    <p class="text-gray-500">Holati:</p>
                    <p id="installmentStatus">
                      <span class="status-badge status-active">Faol</span>
                    </p>
                  </div>
                  <div>
                    <p class="text-gray-500">Jami summa:</p>
                    <p class="font-medium" id="installmentTotal">
                      4 250 000 so'm
                    </p>
                  </div>
                  <div>
                    <p class="text-gray-500">Qolgan summa:</p>
                    <p class="font-medium" id="installmentRemaining">
                      1 750 000 so'm
                    </p>
                  </div>
                  <div>
                    <p class="text-gray-500">Keyingi to'lov:</p>
                    <p class="font-medium" id="installmentNextPayment">
                      25.07.2023
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div class="mb-4">
              <div class="flex justify-between text-sm mb-1">
                <span>To'langan</span>
                <span id="installmentPaidPercent">59%</span>
              </div>
              <div class="installment-progress">
                <div class="installment-progress-bar" style="width: 59%"></div>
              </div>
            </div>

            <div class="mb-6">
              <h4 class="font-medium text-gray-800 mb-3">To'lovlar jadvali</h4>
              <div class="border border-gray-200 rounded-lg overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th
                        class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"
                      >
                        #
                      </th>
                      <th
                        class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"
                      >
                        Sana
                      </th>
                      <th
                        class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"
                      >
                        Summa
                      </th>
                      <th
                        class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"
                      >
                        Holati
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    class="bg-white divide-y divide-gray-200"
                    id="installmentPayments"
                  >
                    <tr>
                      <td class="px-4 py-2">1</td>
                      <td class="px-4 py-2">15.06.2023</td>
                      <td class="px-4 py-2">500 000 so'm</td>
                      <td class="px-4 py-2">
                        <span class="status-badge status-completed"
                          >To'langan</span
                        >
                      </td>
                    </tr>
                    <tr>
                      <td class="px-4 py-2">2</td>
                      <td class="px-4 py-2">15.07.2023</td>
                      <td class="px-4 py-2">500 000 so'm</td>
                      <td class="px-4 py-2">
                        <span class="status-badge status-completed"
                          >To'langan</span
                        >
                      </td>
                    </tr>
                    <tr>
                      <td class="px-4 py-2">3</td>
                      <td class="px-4 py-2">15.08.2023</td>
                      <td class="px-4 py-2">500 000 so'm</td>
                      <td class="px-4 py-2">
                        <span class="status-badge status-overdue">Qarz</span>
                      </td>
                    </tr>
                    <tr>
                      <td class="px-4 py-2">4</td>
                      <td class="px-4 py-2">15.09.2023</td>
                      <td class="px-4 py-2">500 000 so'm</td>
                      <td class="px-4 py-2">
                        <span class="status-badge">Kutilmoqda</span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="mb-6">
              <h4 class="font-medium text-gray-800 mb-2">Mahsulot</h4>
              <div
                class="flex items-center p-4 border border-gray-200 rounded-lg"
              >
                <div
                  class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center"
                >
                  <i class="fas fa-laptop text-gray-400"></i>
                </div>
                <div class="ml-4">
                  <p class="font-medium">Noutbuk ASUS VivoBook 15</p>
                  <p class="text-sm text-gray-500">1 x 4 250 000 so'm</p>
                </div>
              </div>
            </div>

            <button class="btn-primary w-full save-btn">
              <i class="fas fa-credit-card mr-2"></i>To'lovni amalga oshirish
            </button>
          </div>
        </div>

        <div id="installmentOverlay" class="overlay"></div>

        <!-- Manzillar paneli -->
        <div
          id="addressPanel"
          class="panel w-full bg-white rounded-xl shadow-sm p-6"
        >
          <div class="sticky-panel-header flex justify-between items-center">
            <h2 class="text-2xl font-bold text-gray-800">
              <i class="fas fa-map-marker-alt mr-2 text-[#4F46E5]"></i>Mening
              manzillarim
            </h2>
            <button onclick="showAddressForm()" class="btn-primary">
              <i class="fas fa-plus mr-2"></i>Yangi manzil
            </button>
          </div>

          <div class="panel-content">
            <div
              id="addressEmpty"
              class="flex flex-col items-center justify-center py-12"
            >
              <div
                class="w-32 h-32 bg-gray-100 rounded-full flex items-center justify-center mb-4"
              >
                <i class="fas fa-map-marker-alt text-4xl text-gray-400"></i>
              </div>
              <p class="text-gray-500 mb-6">
                Sizda saqlangan manzillar mavjud emas
              </p>
              <button onclick="showAddressForm()" class="btn-primary">
                <i class="fas fa-plus mr-2"></i>Manzil qo'shish
              </button>
            </div>

            <div
              id="addressForm"
              class="form-container hidden bg-gray-50 p-6 rounded-lg mb-6"
            >
              <h3 class="text-lg font-medium text-gray-800 mb-4">
                Manzil qo'shish
              </h3>

              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Viloyat *</label
                  >
                  <select
                    id="regionSelect"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4F46E5] focus:border-[#4F46E5]"
                  >
                    <option value="">Viloyat tanlang</option>
                    <option value="Toshkent shahri">Toshkent shahri</option>
                    <option value="Toshkent viloyati">Toshkent viloyati</option>
                    <option value="Andijon viloyati">Andijon viloyati</option>
                    <option value="Farg'ona viloyati">Farg'ona viloyati</option>
                    <option value="Namangan viloyati">Namangan viloyati</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Tuman/Shahar *</label
                  >
                  <select
                    id="districtSelect"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4F46E5] focus:border-[#4F46E5]"
                  >
                    <option value="">Tuman tanlang</option>
                  </select>
                </div>
              </div>

              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >To'liq manzil *</label
                >
                <input
                  type="text"
                  id="addressInput"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4F46E5] focus:border-[#4F46E5]"
                  placeholder="Ko'cha, uy, xonadon raqami"
                />
              </div>

              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >Qishloq/MFY (agar bo'lsa)</label
                >
                <input
                  type="text"
                  id="villageInput"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4F46E5] focus:border-[#4F46E5]"
                  placeholder="Qishloq yoki MFY nomi"
                />
              </div>

              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >Orientir (ixtiyoriy)</label
                >
                <textarea
                  id="addressLandmark"
                  rows="2"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4F46E5] focus:border-[#4F46E5]"
                  placeholder="Mo'ljal"
                ></textarea>
              </div>

              <div class="flex items-center mb-6">
                <input
                  type="checkbox"
                  id="mainAddress"
                  class="h-4 w-4 text-[#4F46E5] focus:ring-[#4F46E5] border-gray-300 rounded"
                />
                <label
                  for="mainAddress"
                  class="ml-2 block text-sm text-gray-700"
                  >Asosiy manzil sifatida belgilash</label
                >
              </div>

              <div class="flex justify-end gap-3">
                <button
                  onclick="cancelAddressForm()"
                  class="btn-outline cancel-btn"
                >
                  Bekor qilish
                </button>
                <button onclick="saveAddress()" class="btn-primary save-btn">
                  <i class="fas fa-save mr-2"></i>Saqlash
                </button>
              </div>
            </div>

            <div id="addressList" class="grid grid-cols-1 gap-4"></div>
          </div>
        </div>

        <!-- Balans paneli -->
        <div
          id="balancePanel"
          class="panel w-full bg-white rounded-xl shadow-sm p-6"
        >
          <div class="sticky-panel-header">
            <h2 class="text-2xl font-bold text-gray-800">
              <i class="fas fa-wallet mr-2 text-[#4F46E5]"></i>Hisobni
              to'ldirish
            </h2>
          </div>

          <div class="panel-content">
            <div class="max-w-md mx-auto">
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Summa</label
                >
                <div class="relative rounded-md shadow-sm">
                  <input
                    type="number"
                    id="amount"
                    class="block w-full pl-3 pr-12 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-[#4F46E5] focus:border-[#4F46E5]"
                    placeholder="100 000"
                  />
                  <div
                    class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"
                  >
                    <span class="text-gray-500">so'm</span>
                  </div>
                </div>
              </div>

              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >To'lov usuli</label
                >
                <div class="grid grid-cols-2 gap-3">
                  <button
                    onclick="selectPaymentMethod('card')"
                    class="payment-method border border-gray-300 rounded-lg p-4 flex items-center justify-center hover:border-[#4F46E5] transition-colors"
                  >
                    <i class="fas fa-credit-card text-[#4F46E5] mr-2"></i>
                    <span>Karta orqali</span>
                  </button>
                  <button
                    onclick="selectPaymentMethod('payme')"
                    class="payment-method border border-gray-300 rounded-lg p-4 flex items-center justify-center hover:border-[#4F46E5] transition-colors"
                  >
                    <i class="fas fa-mobile-alt text-[#4F46E5] mr-2"></i>
                    <span>Payme</span>
                  </button>
                  <button
                    onclick="selectPaymentMethod('click')"
                    class="payment-method border border-gray-300 rounded-lg p-4 flex items-center justify-center hover:border-[#4F46E5] transition-colors"
                  >
                    <i class="fas fa-qrcode text-[#4F46E5] mr-2"></i>
                    <span>Click</span>
                  </button>
                  <button
                    onclick="selectPaymentMethod('bank')"
                    class="payment-method border border-gray-300 rounded-lg p-4 flex items-center justify-center hover:border-[#4F46E5] transition-colors"
                  >
                    <i class="fas fa-university text-[#4F46E5] mr-2"></i>
                    <span>Bank orqali</span>
                  </button>
                </div>
              </div>

              <button class="btn-primary w-full py-3 save-btn">
                <i class="fas fa-arrow-right mr-2"></i>To'lovni amalga oshirish
              </button>
            </div>
          </div>
        </div>

        <!-- Kuponlar paneli -->
        <div
          id="couponsPanel"
          class="panel w-full bg-white rounded-xl shadow-sm p-6"
        >
          <div class="sticky-panel-header">
            <h2 class="text-2xl font-bold text-gray-800">
              <i class="fas fa-ticket-alt mr-2 text-[#4F46E5]"></i>Kuponlar
            </h2>
          </div>

          <div class="panel-content">
            <div class="grid grid-cols-1 gap-4">
              <div class="coupon-item coupon-active">
                <div class="flex justify-between items-start">
                  <div>
                    <h3 class="text-lg font-bold text-[#4F46E5]">
                      10% chegirma
                    </h3>
                    <p class="text-sm text-gray-600 mt-1">
                      Har qanday mahsulotga
                    </p>
                    <p class="text-xs text-gray-500 mt-2">
                      <i class="far fa-calendar-alt mr-1"></i>Amal qilish
                      muddati: 31.12.2025
                    </p>
                  </div>
                  <span
                    class="bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-1 rounded-full"
                    >Faol</span
                  >
                </div>
                <div class="mt-4 flex justify-between items-center">
                  <div>
                    <p class="text-xs text-gray-500">Kupon kodi:</p>
                    <p class="font-mono text-[#4F46E5]">WELCOME10</p>
                  </div>
                  <button
                    onclick="copyCouponCode('WELCOME10')"
                    class="btn-outline text-sm px-3 py-1"
                  >
                    Nusxa olish
                  </button>
                </div>
              </div>

              <div class="coupon-item coupon-inactive">
                <div class="flex justify-between items-start">
                  <div>
                    <h3 class="text-lg font-bold text-gray-600">5% chegirma</h3>
                    <p class="text-sm text-gray-500 mt-1">
                      Elektronika bo'limiga
                    </p>
                    <p class="text-xs text-gray-400 mt-2">
                      <i class="far fa-calendar-alt mr-1"></i>Muddati o'tgan:
                      30.06.2025
                    </p>
                  </div>
                  <span
                    class="bg-gray-200 text-gray-600 text-xs font-semibold px-2 py-1 rounded-full"
                    >Ishlatilgan</span
                  >
                </div>
                <div class="mt-4 flex justify-between items-center">
                  <div>
                    <p class="text-xs text-gray-400">Kupon kodi:</p>
                    <p class="font-mono text-gray-500">ELECTRO5</p>
                  </div>
                  <button class="btn-outline text-sm px-3 py-1" disabled>
                    Nusxa olish
                  </button>
                </div>
              </div>
            </div>

            <div class="mt-8">
              <h3 class="text-lg font-medium text-gray-800 mb-3">
                Kupon faollashtirish
              </h3>
              <div class="flex gap-2">
                <input
                  type="text"
                  id="couponInput"
                  class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4F46E5] focus:border-[#4F46E5]"
                  placeholder="Kupon kodini kiriting"
                />
                <button onclick="activateCoupon()" class="btn-primary save-btn">
                  <i class="fas fa-check mr-2"></i>Faollashtirish
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Tranzaksiyalar paneli -->
        <div
          id="transactionsPanel"
          class="panel w-full bg-white rounded-xl shadow-sm p-6"
        >
          <div class="sticky-panel-header">
            <h2 class="text-2xl font-bold text-gray-800">
              <i class="fas fa-exchange-alt mr-2 text-[#4F46E5]"></i
              >Tranzaksiyalar tarixi
            </h2>
          </div>

          <div class="panel-content">
            <div class="overflow-x-auto">
              <table class="data-table">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3">ID</th>
                    <th class="px-4 py-3">Sana</th>
                    <th class="px-4 py-3">Turi</th>
                    <th class="px-4 py-3">Summa</th>
                    <th class="px-4 py-3">Holati</th>
                    <th class="px-4 py-3"></th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                  <tr>
                    <td class="px-4 py-3 font-medium text-gray-900">#TX9845</td>
                    <td class="px-4 py-3 text-gray-500">08.07.2025 14:23</td>
                    <td class="px-4 py-3">
                      <span class="inline-flex items-center">
                        <i class="fas fa-arrow-down text-red-500 mr-2"></i>
                        Chiqim
                      </span>
                    </td>
                    <td class="px-4 py-3 text-red-600 font-medium">
                      -550 000 so'm
                    </td>
                    <td class="px-4 py-3">
                      <span class="status-badge status-completed"
                        >Yakunlangan</span
                      >
                    </td>
                    <td class="px-4 py-3">
                      <button class="text-[#4F46E5] hover:text-[#4338CA]">
                        <i class="fas fa-info-circle"></i>
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td class="px-4 py-3 font-medium text-gray-900">#TX9844</td>
                    <td class="px-4 py-3 text-gray-500">07.07.2025 09:12</td>
                    <td class="px-4 py-3">
                      <span class="inline-flex items-center">
                        <i class="fas fa-arrow-up text-green-500 mr-2"></i>
                        Kirim
                      </span>
                    </td>
                    <td class="px-4 py-3 text-green-600 font-medium">
                      +1 000 000 so'm
                    </td>
                    <td class="px-4 py-3">
                      <span class="status-badge status-completed"
                        >Yakunlangan</span
                      >
                    </td>
                    <td class="px-4 py-3">
                      <button class="text-[#4F46E5] hover:text-[#4338CA]">
                        <i class="fas fa-info-circle"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="mt-6 flex justify-between items-center">
              <div class="text-sm text-gray-500">
                Jami: <span class="font-medium">2</span> tranzaksiya
              </div>
              <button class="btn-outline">
                <i class="fas fa-download mr-2"></i>Hisobot yuklash
              </button>
            </div>
          </div>
        </div>

        <!-- Chat paneli -->
        <div
          id="chatPanel"
          class="panel w-full bg-white rounded-xl shadow-sm p-6"
        >
          <div class="sticky-panel-header">
            <h2 class="text-2xl font-bold text-gray-800">
              <i class="fas fa-comment-dots mr-2 text-[#4F46E5]"></i>Chat
            </h2>
          </div>

          <div class="panel-content">
            <div class="border border-gray-200 rounded-lg overflow-hidden">
              <div class="bg-gray-50 p-4 border-b border-gray-200">
                <div class="flex items-center">
                  <div
                    class="w-10 h-10 bg-[#4F46E5] rounded-full flex items-center justify-center text-white"
                  >
                    <i class="fas fa-headset"></i>
                  </div>
                  <div class="ml-3">
                    <p class="font-medium">Qo'llab-quvvatlash xizmati</p>
                    <p class="text-xs text-gray-500">Online</p>
                  </div>
                </div>
              </div>

              <div class="h-96 overflow-y-auto p-4 bg-white" id="chatMessages">
                <div class="space-y-4">
                  <div class="flex justify-start">
                    <div class="max-w-xs lg:max-w-md chat-message-incoming p-3">
                      <p class="text-sm">
                        Assalomu alaykum! Sizga qanday yordam bera olamiz?
                      </p>
                      <p class="chat-message-time">Bugun, 14:23</p>
                    </div>
                  </div>

                  <div class="flex justify-end">
                    <div class="max-w-xs lg:max-w-md chat-message-outgoing p-3">
                      <p class="text-sm">
                        Buyurtma holatini tekshirishim mumkinmi?
                      </p>
                      <p class="chat-message-time text-white/70">
                        Bugun, 14:24
                      </p>
                    </div>
                  </div>

                  <div class="flex justify-start">
                    <div class="max-w-xs lg:max-w-md chat-message-incoming p-3">
                      <p class="text-sm">
                        Albatta. Buyurtma raqamini yozib qoldiring.
                      </p>
                      <p class="chat-message-time">Bugun, 14:25</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="p-4 border-t border-gray-200 bg-gray-50">
                <div class="flex gap-2">
                  <input
                    type="text"
                    id="messageInput"
                    class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4F46E5] focus:border-[#4F46E5]"
                    placeholder="Xabar yozing..."
                    onkeypress="handleChatInput(event)"
                  />
                  <button onclick="sendMessage()" class="btn-primary save-btn">
                    <i class="fas fa-paper-plane"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const regionData = {
        "Toshkent shahri": {
          "Bektemir tumani": [
            "Bektemir shaharchasi",
            "Qatortol MFY",
            "Yangiobod MFY",
          ],
          "Chilonzor tumani": [
            "Chilonzor shaharchasi",
            "Bog'ishamol MFY",
            "Olmazor MFY",
          ],
          "Yunusobod tumani": [
            "Yunusobod shaharchasi",
            "Qo'yliq MFY",
            "Yashnabod MFY",
          ],
        },
        "Toshkent viloyati": {
          "Bekobod tumani": ["Bekobod shahri", "Bekobod MFY", "Do'stlik MFY"],
          "Bo'ka tumani": ["Bo'ka shahri", "Bo'ka MFY", "Qoratosh MFY"],
          "Chinoz tumani": ["Chinoz shahri", "Chinoz MFY", "Gulzor MFY"],
        },
        "Andijon viloyati": {
          "Andijon shahri": [
            "Yangi shahar tumani",
            "Eski shahar tumani",
            "Do'stlik MFY",
            "Navro'z MFY",
            "Ittifoq MFY",
          ],
          "Xonobod shahri": [
            "Alisher Navoiy MFY",
            "Taraqqiyot MFY",
            "Yoshlik MFY",
          ],
          "Asaka tumani": [
            "Asaka shahri",
            "Qorasuv shaharchasi",
            "Xonabod MFY",
            "Istiqlol MFY",
            "Bog'ishamol MFY",
          ],
          "Baliqchi tumani": [
            "Baliqchi shahri",
            "Xojaobod shaharchasi",
            "Chinobod shaharchasi",
            "Olimbek MFY",
            "Guliston MFY",
          ],
          "Bo'ston tumani": [
            "Bo'ston shahri",
            "Paxtaobod MFY",
            "Bo'ston MFY",
            "Qurilish MFY",
          ],
          "Buloqboshi tumani": [
            "Buloqboshi shaharchasi",
            "Xonobod shaharchasi",
            "Sultonobod MFY",
            "Yuqori Qorasuv MFY",
          ],
          "Izboskan tumani": [
            "Poytug shaharchasi",
            "Izboskan MFY",
            "Obod MFY",
            "Toshqurgon MFY",
          ],
          "Jalaquduq tumani": [
            "Jalaquduq shaharchasi",
            "Qoshtepa MFY",
            "Nurli yol MFY",
            "Yangi hayot MFY",
          ],
          "Xojaobod tumani": [
            "Xojaobod shahri",
            "Bog'bon MFY",
            "Mingtepa MFY",
            "Soyboyi MFY",
          ],
          "Qorgontepa tumani": [
            "Qorgontepa shahri",
            "Qorasuv shahri",
            "Sultonobod shaharchasi",
            "Dardoq MFY",
            "Chimyon MFY",
          ],
          "Marhamat tumani": [
            "Marhamat shaharchasi",
            "Xalqobod MFY",
            "Zafar MFY",
            "Qatagon MFY",
          ],
          "Oltinkol tumani": [
            "Oltinkol shaharchasi",
            "Jalabek MFY",
            "Suvyulduz MFY",
            "Qoshtepasaroy MFY",
          ],
          "Paxtaobod tumani": [
            "Paxtaobod shahri",
            "Paxtaobod MFY",
            "Baxoriston MFY",
            "Yangiboston MFY",
          ],
          "Shahrixon tumani": [
            "Shahrixon shahri",
            "Oxunboboyev MFY",
            "Istiqlol MFY",
            "Chimyonobod MFY",
          ],
          "Ulugnor tumani": [
            "Oqoltin shaharchasi",
            "Ulugnor MFY",
            "Ishchilar MFY",
            "Xalqobod MFY",
          ],
        },

        "Farg'ona viloyati": {
          "Farg'ona shahri": [
            "Yangi Marg'ilon tumani",
            "Qo'qon shahri",
            "Rishton tumani",
          ],
          "Beshariq tumani": [
            "Beshariq shahri",
            "Beshariq MFY",
            "Qizilqiya MFY",
          ],
          "Dang'ara tumani": [
            "Dang'ara shahri",
            "Dang'ara MFY",
            "Oltiariq MFY",
          ],
        },
        "Namangan viloyati": {
          "Namangan shahri": [
            "Yangi Namangan tumani",
            "Pop tumani",
            "Chust tumani",
          ],
          "Kosonsoy tumani": [
            "Kosonsoy shahri",
            "Kosonsoy MFY",
            "Chorkesar MFY",
          ],
          "Mingbuloq tumani": [
            "Mingbuloq shahri",
            "Mingbuloq MFY",
            "Jomasho'y MFY",
          ],
        },
      };

      let editIndex = null;
      let currentPanel = "orders";
      let currentInstallmentTab = "active";
      let selectedPaymentMethod = null;
      let cardVisibility = {}; // To track card number visibility

      document.addEventListener("DOMContentLoaded", function () {
        initializeRegionSelect();
        showPanel(currentPanel);
        loadCards();
        loadAddresses();

        document
          .getElementById("cardNumber")
          .addEventListener("input", function (e) {
            let value = e.target.value.replace(/\D/g, "");
            let formatted = "";

            for (let i = 0; i < value.length; i++) {
              if (i > 0 && i % 4 === 0) formatted += " ";
              formatted += value[i];
            }

            e.target.value = formatted.substring(0, 19);
          });

        document
          .getElementById("cardExpiry")
          .addEventListener("input", function (e) {
            let value = e.target.value.replace(/\D/g, "");
            if (value.length > 2) {
              value = value.substring(0, 2) + "/" + value.substring(2, 4);
            }
            e.target.value = value.substring(0, 5);
          });

        document
          .getElementById("cardCvv")
          .addEventListener("input", function (e) {
            e.target.value = e.target.value.replace(/\D/g, "").substring(0, 4);
          });
      });

      function initializeRegionSelect() {
        const regionSelect = document.getElementById("regionSelect");
        regionSelect.innerHTML = '<option value="">Viloyat tanlang</option>';

        Object.keys(regionData).forEach((region) => {
          regionSelect.add(new Option(region, region));
        });

        regionSelect.addEventListener("change", function () {
          updateDistrictSelect(this.value);
        });
      }

      function updateDistrictSelect(region) {
        const districtSelect = document.getElementById("districtSelect");
        districtSelect.innerHTML = '<option value="">Tuman tanlang</option>';

        if (region && regionData[region]) {
          Object.keys(regionData[region]).forEach((district) => {
            districtSelect.add(new Option(district, district));
          });
        }
      }

      function showNotification(text, type = "info") {
        const container = document.getElementById("notificationContainer");
        const notification = document.createElement("div");

        const colors = {
          info: "bg-blue-100 border-blue-500 text-blue-700",
          success: "bg-green-100 border-green-500 text-green-700",
          warning: "bg-yellow-100 border-yellow-500 text-yellow-700",
          error: "bg-red-100 border-red-500 text-red-700",
        };

        notification.className = `notification mb-2 px-4 py-3 rounded-lg shadow-lg text-sm font-medium border ${colors[type]}`;
        notification.innerHTML = `
        <div class="flex items-center justify-between">
          <span>${text}</span>
          <button onclick="this.parentElement.parentElement.remove()" class="ml-4">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;

        container.appendChild(notification);

        setTimeout(() => {
          notification.style.animation = "fadeOut 0.5s ease-out forwards";
          setTimeout(() => notification.remove(), 500);
        }, 4000);
      }

      function showPanel(panel) {
        document.querySelectorAll(".panel").forEach((p) => {
          p.classList.remove("active");
        });

        document.getElementById(`${panel}Panel`).classList.add("active");
        currentPanel = panel;

        // Scroll to top of the content area
        document
          .querySelector(".content-area")
          .scrollTo({ top: 0, behavior: "smooth" });
      }

      function changeInstallmentTab(tab) {
        currentInstallmentTab = tab;

        document
          .querySelectorAll("#installmentPanel .tab-button")
          .forEach((btn) => {
            btn.classList.remove("active");
          });
        event.target.classList.add("active");

        document
          .getElementById("activeInstallments")
          .classList.toggle("hidden", tab !== "active");
        document
          .getElementById("completedInstallments")
          .classList.toggle("hidden", tab !== "completed");
      }

      function showOrderDetails(orderId) {
        document.getElementById("orderDetailsPanel").classList.add("active");
        document.getElementById("orderOverlay").classList.add("active");
      }

      function hideOrderDetails() {
        document.getElementById("orderDetailsPanel").classList.remove("active");
        document.getElementById("orderOverlay").classList.remove("active");
      }

      function showInstallmentDetails(contractNumber) {
        const panel = document.getElementById("installmentDetailsPanel");
        const details = {
          "M-2023-0456": {
            number: "M-2023-0456",
            date: "15.06.2023",
            status: "active",
            total: "4 250 000 so'm",
            remaining: "1 750 000 so'm",
            nextPayment: "25.07.2023",
            paidPercent: "59%",
          },
          "M-2023-0789": {
            number: "M-2023-0789",
            date: "10.05.2023",
            status: "overdue",
            total: "3 500 000 so'm",
            remaining: "2 100 000 so'm",
            nextPayment: "10.08.2023",
            paidPercent: "40%",
          },
        };

        const data = details[contractNumber];

        document.getElementById("installmentNumber").textContent = data.number;
        document.getElementById("installmentContractNumber").textContent =
          data.number;
        document.getElementById("installmentDate").textContent = data.date;
        document.getElementById("installmentTotal").textContent = data.total;
        document.getElementById("installmentRemaining").textContent =
          data.remaining;
        document.getElementById("installmentNextPayment").textContent =
          data.nextPayment;
        document.getElementById("installmentPaidPercent").textContent =
          data.paidPercent;
        document.querySelector(".installment-progress-bar").style.width =
          data.paidPercent;

        let statusBadge = "";
        if (data.status === "active") {
          statusBadge = '<span class="status-badge status-active">Faol</span>';
        } else if (data.status === "overdue") {
          statusBadge = '<span class="status-badge status-overdue">Qarz</span>';
        }
        document.getElementById("installmentStatus").innerHTML = statusBadge;

        panel.classList.add("active");
        document.getElementById("installmentOverlay").classList.add("active");
      }

      function hideInstallmentDetails() {
        document
          .getElementById("installmentDetailsPanel")
          .classList.remove("active");
        document
          .getElementById("installmentOverlay")
          .classList.remove("active");
      }

      function showEditForm() {
        document.getElementById("editForm").classList.remove("hidden");
      }

      function cancelEdit() {
        document.getElementById("editForm").classList.add("hidden");
      }

      function saveProfile() {
        // Get all values from form
        const name = document.getElementById("edit-name").value;
        const passport = document.getElementById("edit-passport").value;
        const email = document.getElementById("edit-email").value;
        const phone = document.getElementById("edit-phone").value;
        const job = document.getElementById("edit-job").value;
        const jobAddress = document.getElementById("edit-job-address").value;
        const birthdate = document.getElementById("edit-birthdate").value;
        const address = document.getElementById("edit-address").value;
        const gender = document.getElementById("edit-gender").value;

        // Update display values
        document.getElementById("display-name").textContent = name;
        document.getElementById("display-passport").textContent = passport;
        document.getElementById("display-email").textContent = email;
        document.getElementById("display-phone").textContent = phone;
        document.getElementById("display-job").textContent = job;
        document.getElementById("display-job-address").textContent = jobAddress;

        // Format date for display
        const formattedDate = new Date(birthdate).toLocaleDateString("uz-UZ");
        document.getElementById("display-birthdate").textContent =
          formattedDate;

        document.getElementById("display-address").textContent = address;
        document.getElementById("display-gender").textContent = gender;

        // Hide form
        document.getElementById("editForm").classList.add("hidden");

        // Show success notification
        showNotification(
          "Profil ma'lumotlari muvaffaqiyatli yangilandi!",
          "success"
        );
      }

      function showAddressForm(isEdit = false) {
        document.getElementById("addressEmpty").classList.add("hidden");
        const form = document.getElementById("addressForm");
        form.classList.remove("hidden");
        form.style.animation = "none";
        form.offsetHeight;
        form.style.animation = null;

        if (!isEdit) {
          resetAddressForm();
        }
      }

      function cancelAddressForm() {
        const form = document.getElementById("addressForm");
        form.style.animation = "fadeOut 0.3s ease-out forwards";
        setTimeout(() => {
          form.classList.add("hidden");
          resetAddressForm();

          const list = document.getElementById("addressList");
          if (list.children.length === 0) {
            document.getElementById("addressEmpty").classList.remove("hidden");
          }
        }, 300);
      }

      function resetAddressForm() {
        document.getElementById("addressInput").value = "";
        document.getElementById("regionSelect").value = "";
        document.getElementById("districtSelect").innerHTML =
          '<option value="">Tuman tanlang</option>';
        document.getElementById("villageInput").value = "";
        document.getElementById("addressLandmark").value = "";
        document.getElementById("mainAddress").checked = false;
        editIndex = null;
      }

      function saveAddress() {
        const region = document.getElementById("regionSelect").value;
        const district = document.getElementById("districtSelect").value;
        const address = document.getElementById("addressInput").value.trim();
        const village = document.getElementById("villageInput").value.trim();
        const landmark = document
          .getElementById("addressLandmark")
          .value.trim();
        const isMain = document.getElementById("mainAddress").checked;

        if (!region || !district || !address) {
          showNotification("Iltimos, barcha maydonlarni to'ldiring!", "error");
          return;
        }

        const addressObj = {
          region,
          district,
          address,
          village,
          landmark,
          isMain,
        };

        let addresses = JSON.parse(localStorage.getItem("addresses")) || [];

        if (editIndex !== null) {
          addresses[editIndex] = addressObj;
          showNotification("Manzil muvaffaqiyatli tahrirlandi!", "success");
          editIndex = null;
        } else {
          addresses.push(addressObj);
          showNotification("Yangi manzil qo'shildi!", "success");
        }

        if (isMain) {
          addresses.forEach((addr) => {
            if (addr !== addressObj) addr.isMain = false;
          });
        }

        localStorage.setItem("addresses", JSON.stringify(addresses));

        loadAddresses();

        cancelAddressForm();
      }

      function loadAddresses() {
        const addresses = JSON.parse(localStorage.getItem("addresses")) || [];
        renderAddresses(addresses);
      }

      function renderAddresses(addresses) {
        const list = document.getElementById("addressList");
        const emptyState = document.getElementById("addressEmpty");

        list.innerHTML = "";

        if (addresses.length === 0) {
          emptyState.classList.remove("hidden");
          return;
        }

        emptyState.classList.add("hidden");

        addresses.forEach((addr, index) => {
          const container = document.createElement("div");
          container.className =
            "address-item bg-white border border-gray-200 rounded-lg p-6";

          let addressText = `${addr.region}, ${addr.district}`;
          if (addr.village) addressText += `, ${addr.village}`;
          addressText += `, ${addr.address}`;

          container.innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <h3 class="text-lg font-medium text-gray-900">
                <i class="fas ${
                  addr.isMain
                    ? "fa-home text-[#4F46E5]"
                    : "fa-building text-blue-500"
                } mr-2"></i>
                ${addr.isMain ? "Asosiy manzil" : "Qo'shimcha manzil"}
                ${
                  addr.isMain
                    ? '<span class="ml-2 px-2 py-1 text-xs bg-[#EEF2FF] text-[#4F46E5] rounded-full">Asosiy</span>'
                    : ""
                }
              </h3>
              <p class="text-gray-700 mt-2">
                <i class="fas fa-map-marker-alt text-gray-400 mr-2"></i>
                ${addressText}
              </p>
              ${
                addr.landmark
                  ? `<p class="text-gray-500 text-sm mt-2">
                <i class="fas fa-compass text-gray-400 mr-2"></i>
                ${addr.landmark}
              </p>`
                  : ""
              }
            </div>
            <div class="flex gap-2">
              <button onclick="editAddress(${index})" class="text-[#4F46E5] hover:text-[#4338CA] p-2">
                <i class="fas fa-edit"></i>
              </button>
              <button onclick="deleteAddress(${index})" class="text-red-600 hover:text-red-800 p-2">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
        `;

          list.appendChild(container);
        });
      }

      function editAddress(index) {
        const addresses = JSON.parse(localStorage.getItem("addresses")) || [];
        const addr = addresses[index];

        editIndex = index;

        document.getElementById("regionSelect").value = addr.region;
        updateDistrictSelect(addr.region);

        setTimeout(() => {
          document.getElementById("districtSelect").value = addr.district;
          document.getElementById("addressInput").value = addr.address;
          document.getElementById("villageInput").value = addr.village || "";
          document.getElementById("addressLandmark").value =
            addr.landmark || "";
          document.getElementById("mainAddress").checked = addr.isMain || false;
          showAddressForm(true);
        }, 100);
      }

      function deleteAddress(index) {
        const addresses = JSON.parse(localStorage.getItem("addresses")) || [];
        addresses.splice(index, 1);
        localStorage.setItem("addresses", JSON.stringify(addresses));

        loadAddresses();
        showNotification("Manzil o'chirildi", "warning");
      }

      function showCardForm() {
        document.getElementById("cardsEmpty").classList.add("hidden");
        const form = document.getElementById("cardForm");
        form.classList.remove("hidden");
        form.style.animation = "none";
        form.offsetHeight;
        form.style.animation = "slide-down 0.3s ease-out forwards";

        form.scrollIntoView({ behavior: "smooth", block: "nearest" });
      }

      function cancelCardForm() {
        const form = document.getElementById("cardForm");
        form.style.animation = "fadeOut 0.3s ease-out forwards";
        setTimeout(() => {
          form.classList.add("hidden");
          resetCardForm();
        }, 300);
      }

      function resetCardForm() {
        document.getElementById("cardNumber").value = "";
        document.getElementById("cardHolder").value = "";
        document.getElementById("cardExpiry").value = "";
        document.getElementById("cardCvv").value = "";
        document.getElementById("mainCard").checked = false;
        editIndex = null;
      }

      function saveCard() {
        const number = document.getElementById("cardNumber").value.trim();
        const holder = document.getElementById("cardHolder").value.trim();
        const expiry = document.getElementById("cardExpiry").value.trim();
        const cvv = document.getElementById("cardCvv").value.trim();
        const isMain = document.getElementById("mainCard").checked;

        if (!number || !holder || !expiry || !cvv) {
          showNotification("Iltimos, barcha maydonlarni to'ldiring!", "error");
          return;
        }

        const cleanNumber = number.replace(/\s/g, "");
        if (!/^\d{16}$/.test(cleanNumber)) {
          showNotification("Karta raqami noto'g'ri kiritilgan!", "error");
          return;
        }

        const cards = JSON.parse(localStorage.getItem("cards")) || [];
        const cardExists = cards.some(
          (card) => card.number.replace(/\s/g, "") === cleanNumber
        );

        if (cardExists) {
          showNotification("Bu karta allaqachon qo'shilgan", "error");
          return;
        }

        if (!/^\d{2}\/\d{2}$/.test(expiry)) {
          showNotification(
            "Amal qilish muddati noto'g'ri kiritilgan!",
            "error"
          );
          return;
        }

        if (!/^\d{3,4}$/.test(cvv)) {
          showNotification("CVV kod noto'g'ri kiritilgan!", "error");
          return;
        }

        let cardType = "other";
        let cardTypeLogo = "";

        if (cleanNumber.startsWith("8600")) {
          cardType = "uzcard";
          cardTypeLogo = "https://logo.clearbit.com/uzcard.uz";
        } else if (cleanNumber.startsWith("9860")) {
          cardType = "humo";
          cardTypeLogo = "https://logo.clearbit.com/humo.uz";
        } else if (cleanNumber.startsWith("4916")) {
          cardType = "uzum ";
          cardTypeLogo = "https://logo.clearbit.com/uzum.uz";
        }

        let bank = "";
        let bankLogo = "https://logo.clearbit.com/bank.uz";

        if (cleanNumber.startsWith("860003")) {
          bank = "Xalq Banki";
          bankLogo = "https://logo.clearbit.com/xb.uz";
        } else if (cleanNumber.startsWith("860004")) {
          bank = "Agro Bank";
          bankLogo = "https://logo.clearbit.com/agrobank.uz";
        } else if (cleanNumber.startsWith("860006")) {
          bank = "SQB";
          bankLogo = "https://logo.clearbit.com/sqb.uz";
        } else if (cleanNumber.startsWith("986003")) {
          bank = "Xalq Banki";
          bankLogo = "https://logo.clearbit.com/xb.uz";
        } else if (cleanNumber.startsWith("986011")) {
          bank = "Kapital Bank";
          bankLogo = "https://logo.clearbit.com/kapitalbank.uz";
        }

        const cardObj = {
          id: "card-" + Math.random().toString(36).substr(2, 9), // Generate unique ID
          number: cleanNumber.replace(/(\d{4})/g, "$1 ").trim(),
          holder,
          expiry,
          cvv,
          isMain,
          type: cardType,
          typeLogo: cardTypeLogo,
          bank,
          bankLogo,
        };

        if (editIndex !== null) {
          cards[editIndex] = cardObj;
          showNotification("Karta muvaffaqiyatli tahrirlandi!", "success");
          editIndex = null;
        } else {
          cards.push(cardObj);
          showNotification("Yangi karta qo'shildi!", "success");
        }

        if (isMain) {
          cards.forEach((card) => {
            if (card !== cardObj) card.isMain = false;
          });
        }

        localStorage.setItem("cards", JSON.stringify(cards));

        loadCards();

        cancelCardForm();
      }

      function loadCards() {
        const cards = JSON.parse(localStorage.getItem("cards")) || [];
        renderCards(cards);
      }

      function toggleCardVisibility(cardId) {
        cardVisibility[cardId] = !cardVisibility[cardId];
        renderCards(JSON.parse(localStorage.getItem("cards")) || []);
      }

      function renderCards(cards) {
        const list = document.getElementById("cardsList");
        const emptyState = document.getElementById("cardsEmpty");

        list.innerHTML = "";

        if (cards.length === 0) {
          emptyState.classList.remove("hidden");
          return;
        }

        emptyState.classList.add("hidden");

        cards.forEach((card, index) => {
          const container = document.createElement("div");
          container.className = `card-item ${
            card.type === "uzcard"
              ? "card-gradient-uzcard"
              : card.type === "humo"
              ? "card-gradient-humo"
              : "card-gradient-other"
          } text-white p-6 rounded-xl shadow-lg relative overflow-hidden`;

          // Initialize visibility state if not set
          if (cardVisibility[card.id] === undefined) {
            cardVisibility[card.id] = false;
          }

          const maskedNumber = card.number.replace(
            /(\d{4}) (\d{4}) (\d{4}) (\d{4})/,
            "**** **** **** $4"
          );
          const displayNumber = cardVisibility[card.id]
            ? card.number
            : maskedNumber;

          container.innerHTML = `
          <div class="flex justify-between items-start mb-6">
            <div>
              <p class="text-sm opacity-80">Bank kartasi</p>
              <p class="text-xl font-bold mt-1">${
                card.type === "uzcard"
                  ? "UZCARD"
                  : card.type === "humo"
                  ? "HUMO"
                  : "nomalum Carta "
              }</p>
              <p class="text-xs opacity-80 mt-1">${card.bank}</p>
            </div>
            <img src="${
              card.bankLogo
            }" onerror="this.src='https://logo.clearbit.com/bank.uz'" alt="${
            card.bank
          }" class="card-logo">
          </div>
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm opacity-80">Karta raqami</p>
              <p class="text-lg font-mono tracking-wider card-number ${
                cardVisibility[card.id] ? "visible" : "masked"
              }">${displayNumber}</p>
            </div>
            <div class="text-right">
              <p class="text-sm opacity-80">Amal qilish muddati</p>
              <p class="text-lg">${card.expiry}</p>
            </div>
          </div>
          <div class="mt-6 flex justify-between items-center">
            <p class="text-sm opacity-80">${card.holder}</p>
            <div class="flex gap-2">
              <button onclick="toggleCardVisibility('${
                card.id
              }')" class="p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors" title="${
            cardVisibility[card.id] ? "Yashirish" : "Ko'rish"
          }">
                <i class="fas ${
                  cardVisibility[card.id] ? "fa-eye-slash" : "fa-eye"
                }"></i>
              </button>
              <button onclick="editCard(${index})" class="p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors">
                <i class="fas fa-pen"></i>
              </button>
              <button onclick="deleteCard(${index})" class="p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
          ${
            card.isMain
              ? '<div class="absolute top-4 right-4 bg-yellow-400 text-yellow-800 text-xs font-bold px-2 py-1 rounded">ASOSIY</div>'
              : ""
          }
          ${
            card.typeLogo
              ? `<img src="${card.typeLogo}" onerror="this.remove()" alt="${card.type}" class="card-type-logo">`
              : ""
          }
        `;

          list.appendChild(container);
        });
      }

      function editCard(index) {
        const cards = JSON.parse(localStorage.getItem("cards")) || [];
        const card = cards[index];

        editIndex = index;

        document.getElementById("cardNumber").value = card.number;
        document.getElementById("cardHolder").value = card.holder;
        document.getElementById("cardExpiry").value = card.expiry;
        document.getElementById("cardCvv").value = card.cvv;
        document.getElementById("mainCard").checked = card.isMain || false;

        showCardForm();
      }

      function deleteCard(index) {
        const cards = JSON.parse(localStorage.getItem("cards")) || [];
        const card = cards[index];
        delete cardVisibility[card.id];
        cards.splice(index, 1);
        localStorage.setItem("cards", JSON.stringify(cards));

        loadCards();
        showNotification("Karta o'chirildi", "warning");
      }

      function copyCouponCode(code) {
        navigator.clipboard
          .writeText(code)
          .then(() => {
            showNotification(`Kupon kodi nusxalandi: ${code}`, "success");
          })
          .catch((err) => {
            showNotification("Nusxalashda xatolik yuz berdi", "error");
          });
      }

      function activateCoupon() {
        const code = document.getElementById("couponInput").value.trim();
        if (!code) {
          showNotification("Iltimos, kupon kodini kiriting", "error");
          return;
        }

        setTimeout(() => {
          if (code.toUpperCase() === "WELCOME10") {
            showNotification(
              "Kupon muvaffaqiyatli faollashtirildi!",
              "success"
            );
          } else {
            showNotification("Noto'g'ri kupon kodi", "error");
          }
        }, 1000);
      }

      function selectPaymentMethod(method) {
        selectedPaymentMethod = method;

        document.querySelectorAll(".payment-method").forEach((btn) => {
          btn.classList.remove("active");
        });

        event.target.classList.add("active");
      }

      function handleChatInput(event) {
        if (event.key === "Enter") {
          sendMessage();
        }
      }

      function sendMessage() {
        const messageInput = document.getElementById("messageInput");
        const message = messageInput.value.trim();

        if (!message) return;

        const chatMessages = document.getElementById("chatMessages");
        const now = new Date();
        const timeString = now.toLocaleTimeString("uz-UZ", {
          hour: "2-digit",
          minute: "2-digit",
        });

        // Add outgoing message
        const outgoingMessage = document.createElement("div");
        outgoingMessage.className = "flex justify-end";
        outgoingMessage.innerHTML = `
        <div class="max-w-xs lg:max-w-md chat-message-outgoing p-3">
          <p class="text-sm">${message}</p>
          <p class="chat-message-time text-white/70">${timeString}</p>
        </div>
      `;
        chatMessages.appendChild(outgoingMessage);

        // Clear input
        messageInput.value = "";

        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;

        // Simulate reply after 1-2 seconds
        setTimeout(() => {
          const replies = [
            "Xabaringiz qabul qilindi!",
            "Qo'llab-quvvatlash xodimi sizga yordam bera oladi",
            "Iltimos, kuting...",
            "Sizning so'rovingiz ko'rib chiqilmoqda",
          ];
          const randomReply =
            replies[Math.floor(Math.random() * replies.length)];

          const incomingMessage = document.createElement("div");
          incomingMessage.className = "flex justify-start";
          incomingMessage.innerHTML = `
          <div class="max-w-xs lg:max-w-md chat-message-incoming p-3">
            <p class="text-sm">${randomReply}</p>
            <p class="chat-message-time">${timeString}</p>
          </div>
        `;
          chatMessages.appendChild(incomingMessage);

          // Scroll to bottom again
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }, 1000 + Math.random() * 1000);
      }
    </script>
  </body>
</html>
